<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0/EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="faqBoard">
    <!-- 동적쿼리 -->
    <sql id="dynamicCondition">
	    <where>
	        <if test="category != null and category != '' and category != 'all'">
	            faq_category = #{category}
	        </if>
	        <choose>
	            <when test="stype == '' and sword != ''">
	                AND (
	                    faq_title like '%'||#{sword}||'%'
	                    or
	                    faq_contents like '%'||#{sword}||'%'
	                    or
	                    faq_category like '%'||#{sword}||'%'
	                )
	            </when>
	            <when test="!(stype == '' or sword == '')">
	                AND ${stype} like '%'||#{sword}||'%'
	            </when>
	        </choose>
	    </where>
    </sql>

    <!-- FAQ 글쓰기
    {faq_category=reservation, faq_title=질문있어요, faq_contents=답변이에요}
     -->
    <insert id="insertBoard" parameterType="faqboardVo">
    	<selectKey resultType="int" order="BEFORE" keyProperty="faq_id">
    		SELECT NVL(MAX(FAQ_ID),0)+1 FROM FAQ_BOARD
    	</selectKey>
    <!-- -->
		insert into faq_board
				values(
				      #{faq_id},
				      sysdate,
				      #{faq_title},
				      #{faq_contents},
				      #{faq_category},
				      'zzzz'
				      )
    </insert>
	
    <!-- FAQ 글삭제 -->
    <delete id="deleteBoard" parameterType="int">
        delete from faq_board where faq_id = #{faq_id}
    </delete>

    <!-- FAQ 글수정 -->
    <update id="updateBoard" parameterType="faqboardVo">
        update faq_board set
            faq_title = #{faq_title},
            faq_contents = #{faq_contents},
            faq_category = #{faq_category}
        where faq_id = #{faq_id}
    </update>

    <!-- 전체 FAQ 갯수 구하기 -->
    <select id="totalCount" resultType="int" parameterType="map">
        select count(*) from faq_board
        <include refid="dynamicCondition"/>
    </select>

    <!-- 페이지별 FAQ 리스트 검색포함     -->
    <select id="selectByPage" parameterType="map" resultType="faqboardVo">
        select A.* from (
           select rownum as rnum, B.*  from (
               select * from faq_board
               <include refid="dynamicCondition"/>
               order by faq_id desc) B
        <![CDATA[
           where rownum <= #{end} ) A
        where A.rnum >=#{start}
        ]]>
    </select>

</mapper>