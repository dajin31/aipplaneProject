<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="admin">
    <!-- 회원 목록 조회 (검색 및 페이징) -->
    <select id="selectById" parameterType="map" resultType="userVo">
        SELECT A.*
        FROM (
        SELECT ROWNUM AS RNUM, B.*
        FROM (
        SELECT
        USER_ID as userId,
        USER_PW as userPw,
        USER_NAME as userName,
        USER_EMAIL as userEmail,
        USER_REGNUM as userRegNum,
        USER_MILEAGE as userMileage,
        USER_PASSNUM as userPassNum,
        MEM_CODE as memCode,
        USER_TOTALMILEAGE as userTotalMileage
        FROM users
        <where>
            <if test="stype == 'userId' and sword != null and sword != ''">
                USER_ID LIKE '%'||#{sword}||'%'
            </if>
            <if test="stype == 'userName' and sword != null and sword != ''">
                USER_NAME LIKE '%'||#{sword}||'%'
            </if>
            <if test="stype == 'userEmail' and sword != null and sword != ''">
                USER_EMAIL LIKE '%'||#{sword}||'%'
            </if>
            <if test="stype == 'userPassNum' and sword != null and sword != ''">
                USER_PASSNUM LIKE '%'||#{sword}||'%'
            </if>
            <if test="stype == 'all' and sword != null and sword != ''">
                (USER_ID LIKE '%'||#{sword}||'%' OR
                USER_NAME LIKE '%'||#{sword}||'%' OR
                USER_EMAIL LIKE '%'||#{sword}||'%' OR
                USER_PASSNUM LIKE '%'||#{sword}||'%')
            </if>
        and MEM_CODE != 'admin'
        </where>
        ORDER BY USER_ID
        ) B
        <![CDATA[
        WHERE ROWNUM <= #{end}
        ) A
        WHERE A.RNUM >= #{start}
        ]]>
    </select>

    <!-- 전체 회원 수 조회 (검색 조건 적용) -->
    <select id="totalCount" parameterType="map" resultType="int">
        SELECT COUNT(*) FROM users
        <where>
            <if test="stype == 'userId' and sword != null and sword != ''">
                USER_ID LIKE '%'||#{sword}||'%'
            </if>
            <if test="stype == 'userName' and sword != null and sword != ''">
                USER_NAME LIKE '%'||#{sword}||'%'
            </if>
            <if test="stype == 'userEmail' and sword != null and sword != ''">
                USER_EMAIL LIKE '%'||#{sword}||'%'
            </if>
            <if test="stype == 'userPassNum' and sword != null and sword != ''">
                USER_PASSNUM LIKE '%'||#{sword}||'%'
            </if>
            <if test="stype == 'all' and sword != null and sword != ''">
                (USER_ID LIKE '%'||#{sword}||'%' OR
                USER_NAME LIKE '%'||#{sword}||'%' OR
                USER_EMAIL LIKE '%'||#{sword}||'%' OR
                USER_PASSNUM LIKE '%'||#{sword}||'%')
            </if>
            and MEM_CODE != 'admin'
        </where>
    </select>

    <!-- 회원 상세 정보 조회 -->
    <select id="getUserById" parameterType="string" resultType="userVo">
        SELECT
            USER_ID as userId,
            USER_PW as userPw,
            USER_NAME as userName,
            USER_EMAIL as userEmail,
            USER_REGNUM as userRegNum,
            USER_MILEAGE as userMileage,
            USER_PASSNUM as userPassNum,
            MEM_CODE as memCode,
            USER_TOTALMILEAGE as userTotalMileage
        FROM users
        WHERE USER_ID = #{userId}
    </select>

    <!-- 회원 정보 수정 -->
    <update id="updateUser" parameterType="userVo">
        UPDATE users
        SET USER_PW = #{userPw},
            USER_EMAIL = #{userEmail},
            USER_MILEAGE = #{userMileage},
            USER_PASSNUM = #{userPassNum},
            USER_TOTALMILEAGE = #{userTotalMileage},
            MEM_CODE = #{memCode}
        WHERE USER_ID = #{userId}
    </update>

    <!-- 회원 삭제 -->
    <delete id="deleteUser" parameterType="string">
        DELETE FROM users WHERE USER_ID = #{userId}
    </delete>

</mapper>